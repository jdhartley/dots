var DOTS=function(){"use strict";var e=["g","p","r","b","y"],t=!1,n,r=[],i=0,s=0,o=function(){$(window).resize(function(){$("html, body").css("font-size",Math.min($("html").width(),$("html").height())/30)}).trigger("resize")[0].scrollTo(0,0);for(var e=0;e<6;e++)$("body").append($("<ul/>").each(function(){for(var e=0;e<6;e++)$(this).append(u())}));$("html, body").on("touchstart touchmove",function(e){e.preventDefault()});$("body").on("dblclick","li",function(e){$(this).trigger("dotRemove")}).on("mousedown touchstart","li",function(e){if(t===!0)return;e.preventDefault();e=a(e);var i=document.elementFromPoint(e.pageX,e.pageY);t=!0;n=$(i).addClass("active").attr("class").replace("active","").trim();r.push(i);s++;l()}).on("mousemove touchmove","li",function(e){e=a(e);var i=document.elementFromPoint(e.pageX,e.pageY);if(!t)return;if(n!==$(i).attr("class").replace("active","").trim())return;var o=$("li"),u=o.index($(i)),c=!1,h=-1;if(r.length>0){c=$(r[r.length-1]);h=o.index(c);if(u!==h&&u+6!==h&&u-6!==h&&u+1!==h&&u-1!==h)return;if(u===o.index($(r[r.length-2]))){c.removeClass("active");r.pop();s--;l();$("body").hasClass("inSquare")&&!f()&&$("body").removeClass();return}}if(!$(i).hasClass("active")||u!==h){$(i).addClass("active");r.push(i);s++;if(f()){$("body").addClass("inSquare "+n);l(!0)}else l()}}).on("mouseup touchend",function(){t=!1;r.length>1&&$(f()?$("."+n):r).trigger("dotRemove");r=[];$("li.active").removeClass("active");$("body").removeClass("inSquare");s=0}).on("dotRemove","li",function(){var e=$(this);$(this).parent().append(u());setTimeout(function(){e.remove()},0)})},u=function(){return $("<li/>").addClass(e[Math.floor(Math.random()*5)]).attr("id","d"+ ++i)},a=function(e){return e.originalEvent?e.originalEvent.touches&&e.originalEvent.touches.length?e.originalEvent.touches[0]:e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length?e.originalEvent.changedTouches[0]:e:e},f=function(){var e=$(r).map(function(){return this.id}),t={};for(var n=0;n<e.length;n++){if(Object.prototype.hasOwnProperty.call(t,e[n]))return!0;t[e[n]]=!0}return!1},l=function(e){var t=new Synthesizer,n=function(e){for(var t=56,e=e-1;e>0;e--)t+=[3,2,2,3,2][e%5];return t},r=n(s);t.on(r);setTimeout(function(){t.off(r)},500)};return{init:o}}();$(DOTS.init);